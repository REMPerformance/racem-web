<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>RACEM – Katalóg dielov</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --red:#b31f24;
      --bg:#0b0b0b;
      --panel:#141414;
      --text:#ffffff;
      --muted:#cfcfcf;
      --muted2:#9b9b9b;
      --line: rgba(255,255,255,0.08);
      --shadow: 0 14px 40px rgba(0,0,0,0.48);
      --radius-xl: 18px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #151515 0, #050505 55%, #000 100%);
      color:var(--text);
      overflow-x:hidden;
    }

    /* NOISE LAYER */
    .noise{
      pointer-events:none;
      position:fixed;
      inset:0;
      opacity:0.09;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2'%3E%3C/feTurbulence%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.52'/%3E%3C/svg%3E");
      z-index:-1;
    }

    .wrap{
      width:100%;
      max-width:none;
      margin:0;
      padding:0 32px 40px;
    }

    /* NAVBAR */
    header{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter:blur(18px);
      background:linear-gradient(to bottom, rgba(5,5,5,0.96), rgba(5,5,5,0.8), transparent);
      border-bottom:1px solid rgba(255,255,255,0.04);
    }

    .nav{
      width:100%;
      max-width:none;
      margin:0;
      padding:14px 32px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:#fff;
    }
    .brand img{
      height:40px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 24px rgba(179,31,36,0.22));
      transition: transform .2s ease, filter .2s ease;
    }
    .brand:hover img{ transform: translateY(-1px) scale(1.02); }

    .brand-text{ display:flex; flex-direction:column; gap:2px; line-height:1; }
    .brand-title{
      font-size:18px;
      font-weight:900;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:#fff;
    }
    .brand-sub{
      font-size:10px;
      text-transform:uppercase;
      color:var(--muted2);
      letter-spacing:0.18em;
    }

    .nav-links{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      font-size:13px;
      text-transform:uppercase;
    }

    .nav-links a{
      text-decoration:none;
      color:var(--muted);
      padding:7px 12px;
      border-radius:999px;
      border:1px solid transparent;
      background:rgba(20,20,20,0.7);
      display:flex;
      align-items:center;
      gap:8px;
      transition:all .18s ease-out;
    }

    .nav-links a span.dot{
      width:6px;
      height:6px;
      border-radius:999px;
      background:rgba(255,255,255,0.3);
    }

    .nav-links a:hover{
      color:var(--text);
      border-color:rgba(255,255,255,0.18);
      transform:translateY(-1px);
      box-shadow:0 10px 25px rgba(0,0,0,0.6);
    }

    .nav-links a.active{
      color:#fff;
      border-color:var(--red);
      background:linear-gradient(135deg, rgba(179,31,36,0.12), rgba(179,31,36,0.02));
    }
    .nav-links a.active .dot{
      background:var(--red);
      box-shadow:0 0 12px rgba(179,31,36,0.85);
    }

    /* PAGE HEADER */
    .page-header{
      padding:30px 0 10px;
    }
    .page-kicker{
      font-size:11px;
      text-transform:uppercase;
      color:var(--muted2);
      letter-spacing:0.25em;
      margin-bottom:8px;
    }
    .page-title{
      font-size:32px;
      font-weight:800;
      letter-spacing:0.08em;
      text-transform:uppercase;
      margin:0 0 8px;
    }
    .page-sub{
      font-size:14px;
      color:var(--muted);
      max-width:none;
      line-height:1.5;
      margin:0 0 14px;
    }

    /* ===== PILLS FILTER ===== */
    .filter-row{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 10px 0 6px;
    }
    .filter-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.22em;
      color:var(--muted2);
      white-space:nowrap;
    }

    .pillbar{
      display:flex;
      align-items:center;
      gap:8px;
      overflow:auto;
      padding:8px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.22);
      box-shadow: 0 18px 55px rgba(0,0,0,0.45);
      scrollbar-width:none;
      -ms-overflow-style:none;
      scroll-behavior:smooth;
      flex:1;
      min-height:44px;
    }
    .pillbar::-webkit-scrollbar{ display:none; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(20,20,20,0.58);
      color: rgba(255,255,255,0.88);
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      transition: transform .14s ease, border-color .14s ease, background .14s ease, box-shadow .14s ease;
    }
    .pill:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.20);
      box-shadow: 0 12px 28px rgba(0,0,0,0.55);
    }

    .pill .count{
      font-size:10px;
      letter-spacing:.18em;
      color: var(--muted2);
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      padding:4px 8px;
      border-radius:999px;
    }

    .pill.active{
      border-color: rgba(179,31,36,0.55);
      background: linear-gradient(135deg, rgba(179,31,36,0.18), rgba(179,31,36,0.05));
      box-shadow: 0 0 22px rgba(179,31,36,0.16);
      color:#fff;
    }
    .pill.active .count{
      color:#fff;
      border-color: rgba(179,31,36,0.45);
      background: rgba(179,31,36,0.16);
    }

    .pill.clear{
      border-color: rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
    }
    .pill.clear .x{
      width:18px; height:18px; border-radius:999px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      font-size:12px;
      line-height:1;
    }

    .pill.more{
      border-color: rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      color:#fff;
    }

    /* SEKCIE */
    section.catalog-section{
      margin:18px 0 32px;
    }

    .section-header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }

    .section-title{
      font-size:18px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.12em;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .section-title::before{
      content:"";
      width:22px;
      height:2px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--red), transparent);
    }

    .section-note{
      font-size:12px;
      color:var(--muted2);
      max-width:none;
      line-height:1.4;
    }

    /* GRID */
    .parts-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));
      gap:16px;
      justify-content:flex-start;
      align-items:stretch;
    }

    /* 7 produktov v riadku na veľkých monitoroch */
    @media (min-width: 1650px){
      .parts-grid{ grid-template-columns: repeat(7, minmax(0, 1fr)); }
    }

    .part-card{
      position:relative;
      background:
        radial-gradient(circle at top left, rgba(179,31,36,0.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.16)),
        var(--panel);
      border-radius:var(--radius-xl);
      border:1px solid var(--line);
      padding:14px 14px 12px;
      box-shadow:var(--shadow);
      overflow:hidden;
      transition: transform .16s ease, border-color .16s ease, box-shadow .16s ease;
      transform: translateZ(0);

      /* performance: renderuj karty až keď sú na obrazovke */
      content-visibility: auto;
      contain-intrinsic-size: 360px;
    }

    .part-card:hover{
      transform:translateY(-2px);
      border-color: rgba(179,31,36,0.28);
      box-shadow: 0 18px 54px rgba(0,0,0,0.58);
    }

    .part-top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      align-items:flex-start;
    }

    .part-name{
      font-size:14px;
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
      line-height:1.2;
      margin-bottom:4px;
    }

    .part-meta{
      font-size:12px;
      color: rgba(255,255,255,0.78);
      line-height:1.45;
    }

    .part-badge{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(34,197,94,0.50);
      background: radial-gradient(circle at top, rgba(34,197,94,0.14), transparent 60%);
      color: rgba(255,255,255,0.92);
      white-space:nowrap;
      flex-shrink:0;
    }

    .part-image{
      width:100%;
      height:190px;
      border-radius:16px;
      overflow:hidden;
      margin:10px 0 10px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.50);
      position:relative;
    }

    .part-image img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      transition: transform .22s ease;
    }

    .part-card:hover .part-image img{ transform: scale(1.02); }

    .image-nav-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(0,0,0,0.60);
      color:#fff;
      font-size:14px;
      cursor:pointer;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease-out, transform .18s ease-out;
      backdrop-filter: blur(8px);
    }

    .image-nav-btn.prev{ left:8px; }
    .image-nav-btn.next{ right:8px; }

    .part-image:hover .image-nav-btn{
      opacity:1;
      pointer-events:auto;
      transform:translateY(-50%) scale(1.02);
    }

    .part-tags{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:10px;
    }

    .tag{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.11em;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.72);
      background: rgba(0,0,0,0.30);
    }

    .part-note{
      font-size:13px;
      color: rgba(255,255,255,0.86);
      margin: 0 0 12px;
      line-height:1.55;
    }

    .part-bottom{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .price{
      font-size:16px;
      font-weight:900;
      letter-spacing:.04em;
      color: var(--red);
      text-shadow: 0 0 18px rgba(179,31,36,0.18);
      line-height:1.1;
    }

    .price span{
      display:inline-block;
      font-size:11px;
      font-weight:400;
      color:var(--muted2);
      margin-left:8px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }

    .cta-mini{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(135deg, var(--red), #740509);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      cursor:pointer;
      color:#fff;
      white-space:nowrap;
      transition:all .16s ease-out;
    }

    .cta-mini:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 36px rgba(179,31,36,0.22);
      filter: brightness(1.03);
    }

    .empty{
      padding: 18px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      color: var(--muted2);
      font-size:13px;
      line-height:1.6;
    }

    footer{
      border-top:1px solid rgba(255,255,255,0.06);
      padding:18px 0 30px;
      font-size:11px;
      color:var(--muted2);
      background: rgba(0,0,0,0.25);
    }

    footer .row{
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:8px;
      padding:0 32px;
    }

    footer a{
      color:var(--muted);
      text-decoration:none;
    }
    footer a:hover{
      color:#fff;
      text-decoration:underline;
    }

    @media (max-width:980px){
      .wrap{ padding:0 16px 32px; }
      .nav{ padding:12px 16px 10px; }
      footer .row{ padding:0 16px; }
      .page-title{ font-size:28px; }
      .filter-row{ flex-direction:column; align-items:flex-start; gap:8px; }
      .pillbar{ width:100%; }
    }

    @media (max-width:640px){
      .page-title{font-size:26px;}
      .parts-grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
<div class="noise"></div>

<header>
  <nav class="nav">
    <a class="brand" href="index.html" aria-label="RACEM homepage">
      <img src="assets/racem-logo.png" alt="RACEM logo">
      <div class="brand-text">
        <div class="brand-title">RACEM</div>
        <div class="brand-sub">BEAT THEM ALL</div>
      </div>
    </a>

    <div class="nav-links">
      <a href="index.html"><span class="dot"></span><span>Homepage</span></a>
      <a href="katalog.html" class="active"><span class="dot"></span><span>Katalóg dielov</span></a>
      <a href="vop.html"><span class="dot"></span><span>VOP & reklamácie</span></a>
    </div>
  </nav>
</header>

<main class="wrap">
  <section class="page-header">
    <div class="page-kicker">REM PERFORMANCE · RACEM</div>
    <h1 class="page-title">KATALÓG DIELOV</h1>
    <p class="page-sub">
      Toto sú diely, ktoré máme fyzicky <b>na sklade doma</b> a vieme ich poslať hneď.
      Potrebuješ niečo iné? Napíš na <b>info@remperformance.sk</b>.
    </p>

    <!-- PILLS FILTER -->
    <div class="filter-row">
      <div class="filter-label">Filter: model auta</div>
      <div id="pillbar" class="pillbar" aria-label="Pills filter"></div>
    </div>
  </section>

  <section id="skladom" class="catalog-section">
    <div class="section-header">
      <h2 class="section-title">Skladom – k odoslaniu ihneď</h2>
      <p class="section-note">Diely, ktoré sú fyzicky u nás. Počet kusov je obmedzený.</p>
    </div>

    <div id="parts-skladom" class="parts-grid"></div>
  </section>
</main>

<footer>
  <div class="row">
    <div>RACEM / REM Performance · Lukáš Tonkovič · IČO 57321205</div>
    <div>
      <a href="mailto:info@remperformance.sk">info@remperformance.sk</a> ·
      <a href="vop.html">VOP a reklamačný poriadok</a>
    </div>
  </div>
</footer>

<script>
  const JSON_URL = "skladom.json";
  const $ = (s, r=document) => r.querySelector(s);
  const safe = (v) => (v == null) ? "" : String(v);

  let ALL = [];
  let ACTIVE_MODEL = "all";       // encoded model alebo "all"
  let MODEL_COUNTS = new Map();
  let SHOW_ALL_PILLS = false;

  const MAX_PILLS_COLLAPSED = 10;

  function inferModel(part){
    const direct = safe(part.model).trim();
    if (direct) return direct;

    const meta = safe(part.meta).trim();
    if (!meta) return "Neurčené";

    const first = meta.split("·")[0].trim();
    return first || "Neurčené";
  }

  function normalizePart(raw){
    const p = Object.assign({}, raw);
    const base = (p.image && String(p.image).trim()) ? String(p.image).trim() : "img/placeholder-part.jpg";
    const extra = Array.isArray(p.images) ? p.images.map(String).map(s=>s.trim()).filter(Boolean) : [];
    p.allImages = [base, ...extra.filter(src => src !== base)];
    p.tags = Array.isArray(p.tags) ? p.tags : [];
    p._model = inferModel(p);
    return p;
  }

  function computeModels(){
    MODEL_COUNTS = new Map();
    ALL.forEach(p => MODEL_COUNTS.set(p._model, (MODEL_COUNTS.get(p._model) || 0) + 1));
  }

  function buildCardHTML(part){
    const tagsHtml = (part.tags || []).map(t => `<span class="tag">${t}</span>`).join("");
    const imageSrc = (part.allImages && part.allImages.length) ? part.allImages[0] : "img/placeholder-part.jpg";
    const hasGallery = part.allImages && part.allImages.length > 1;
    const priceValue = safe(part.price) || "Na dopyt";
    const suffix = safe(part.price_suffix);

    return `
      <article class="part-card" data-model="${encodeURIComponent(part._model)}">
        <div class="part-top">
          <div>
            <div class="part-name">${safe(part.name)}</div>
            <div class="part-meta">${safe(part.meta)}</div>
          </div>
          <div class="part-badge">${safe(part.stockLabel) || "Skladom"}</div>
        </div>

        <div class="part-image" data-current-index="0" data-images="${encodeURIComponent((part.allImages||[]).join("|"))}">
          <img src="${imageSrc}" alt="${safe(part.name) || "diel"}" loading="lazy">
          ${hasGallery ? `
            <button type="button" class="image-nav-btn prev" aria-label="Predchádzajúca fotka">&#10094;</button>
            <button type="button" class="image-nav-btn next" aria-label="Ďalšia fotka">&#10095;</button>
          ` : ""}
        </div>

        ${tagsHtml ? `<div class="part-tags">${tagsHtml}</div>` : ""}

        <p class="part-note">${safe(part.note)}</p>

        <div class="part-bottom">
          <div class="price">
            ${priceValue}
            ${suffix ? `<span>${suffix}</span>` : ""}
          </div>
          <button type="button" class="cta-mini">Detail</button>
        </div>
      </article>
    `;
  }

  function bindGallery(container){
    container.querySelectorAll(".part-card").forEach(card => {
      const wrap = card.querySelector(".part-image");
      const prev = card.querySelector(".image-nav-btn.prev");
      const next = card.querySelector(".image-nav-btn.next");
      if (!wrap || (!prev && !next)) return;

      const img = wrap.querySelector("img");
      const images = decodeURIComponent(wrap.dataset.images || "").split("|").filter(Boolean);
      if (images.length <= 1) return;

      function setIdx(i){
        const idx = (i + images.length) % images.length;
        wrap.dataset.currentIndex = String(idx);
        img.src = images[idx];
      }

      prev && prev.addEventListener("click", (e) => {
        e.preventDefault(); e.stopPropagation();
        const cur = parseInt(wrap.dataset.currentIndex || "0", 10) || 0;
        setIdx(cur - 1);
      });

      next && next.addEventListener("click", (e) => {
        e.preventDefault(); e.stopPropagation();
        const cur = parseInt(wrap.dataset.currentIndex || "0", 10) || 0;
        setIdx(cur + 1);
      });
    });
  }

  function applyFilter(){
    const container = $("#parts-skladom");

    let out = ALL.slice();
    if (ACTIVE_MODEL !== "all"){
      out = out.filter(p => encodeURIComponent(p._model) === ACTIVE_MODEL);
    }

    if (!out.length){
      container.innerHTML = `<div class="empty">Pre tento model tu zatiaľ nič nie je.</div>`;
      return;
    }

    container.innerHTML = out.map(buildCardHTML).join("");
    bindGallery(container);
  }

  function setActiveModel(encoded){
    ACTIVE_MODEL = encoded || "all";
    renderPills();
    applyFilter();

    // jemné "center scroll" na aktívny pill
    const activeEl = document.querySelector('.pillbar .pill.active');
    if (activeEl){
      activeEl.scrollIntoView({behavior:"smooth", inline:"center", block:"nearest"});
    }
  }

  function renderPills(){
    const bar = $("#pillbar");
    const models = Array.from(MODEL_COUNTS.entries())
      .sort((a,b) => a[0].localeCompare(b[0], "sk"));

    const totalModels = models.length;
    const shouldCollapse = !SHOW_ALL_PILLS && totalModels > MAX_PILLS_COLLAPSED;

    const visibleModels = shouldCollapse ? models.slice(0, MAX_PILLS_COLLAPSED) : models;

    let html = "";

    // "All" pill
    html += `
      <div class="pill ${ACTIVE_MODEL==="all" ? "active" : ""}" data-model="all">
        Všetky <span class="count">${ALL.length}</span>
      </div>
    `;

    // Clear pill (iba keď je niečo zvolené)
    if (ACTIVE_MODEL !== "all"){
      html += `
        <div class="pill clear" data-model="all" title="Zrušiť filter">
          <span class="x">×</span> Reset
        </div>
      `;
    }

    // model pills
    visibleModels.forEach(([name,count]) => {
      const enc = encodeURIComponent(name);
      html += `
        <div class="pill ${ACTIVE_MODEL===enc ? "active" : ""}" data-model="${enc}">
          ${name} <span class="count">${count}</span>
        </div>
      `;
    });

    if (shouldCollapse){
      const hidden = totalModels - MAX_PILLS_COLLAPSED;
      html += `
        <div class="pill more" data-more="1">
          Viac… <span class="count">+${hidden}</span>
        </div>
      `;
    }else if (SHOW_ALL_PILLS && totalModels > MAX_PILLS_COLLAPSED){
      html += `
        <div class="pill more" data-less="1">
          Menej <span class="count">—</span>
        </div>
      `;
    }

    bar.innerHTML = html;

    // events
    bar.querySelectorAll(".pill[data-model]").forEach(p => {
      p.addEventListener("click", () => {
        const m = p.dataset.model;
        setActiveModel(m);
      });
    });

    const more = bar.querySelector(".pill[data-more]");
    more && more.addEventListener("click", () => {
      SHOW_ALL_PILLS = true;
      renderPills();
    });

    const less = bar.querySelector(".pill[data-less]");
    less && less.addEventListener("click", () => {
      SHOW_ALL_PILLS = false;
      renderPills();
    });
  }

  async function load(){
    const container = $("#parts-skladom");
    try{
      const res = await fetch(JSON_URL);
      if (!res.ok) throw new Error("Nepodarilo sa načítať skladom.json");
      const data = await res.json();
      const raw = Array.isArray(data) ? data : (data.inStock || []);

      ALL = raw.map(normalizePart);

      if (!ALL.length){
        container.innerHTML = `<div class="empty">Momentálne nemáme žiadne diely označené ako <b>skladom</b>.</div>`;
        return;
      }

      computeModels();
      renderPills();
      applyFilter();
    }catch(err){
      console.error(err);
      container.innerHTML = `<div class="empty">Nepodarilo sa načítať skladové diely. Skús obnoviť stránku.</div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
