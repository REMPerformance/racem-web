<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>RACEM ‚Äì Katal√≥g dielov</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FONT (headlines) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --red:#b31f24;
      --bg:#0b0b0b;
      --panel:#141414;
      --text:#ffffff;
      --muted:#cfcfcf;
      --muted2:#9b9b9b;
      --line: rgba(255,255,255,0.08);
      --shadow: 0 18px 55px rgba(0,0,0,0.55);
      --radius-xl: 18px;

      --glass: rgba(255,255,255,0.03);
      --glass2: rgba(255,255,255,0.06);
      --ok: #22c55e;
      --warn: #f59e0b;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #151515 0, #050505 55%, #000 100%);
      color:var(--text);
      overflow-x:hidden;
    }

    /* ===== Ambient + subtle sci-fi layers ===== */
    .bg-ambient{
      position:fixed;
      inset:0;
      z-index:-5;
      pointer-events:none;
      background:
        radial-gradient(circle at 18% 12%, rgba(179,31,36,0.18), transparent 42%),
        radial-gradient(circle at 80% 18%, rgba(179,31,36,0.10), transparent 40%),
        radial-gradient(circle at 55% 75%, rgba(255,255,255,0.03), transparent 52%),
        radial-gradient(circle at 40% 40%, rgba(255,255,255,0.02), transparent 60%);
      filter:saturate(1.1);
    }

    .gridlayer{
      position:fixed;
      inset:0;
      z-index:-4;
      pointer-events:none;
      opacity:0.18;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 56px),
        repeating-linear-gradient(0deg, rgba(255,255,255,0.03) 0 1px, transparent 1px 56px);
      mask-image: radial-gradient(circle at top, #000 0 55%, transparent 78%);
      animation: gridMove 26s linear infinite;
      transform: translateZ(0);
    }
    @keyframes gridMove{
      from{ background-position: 0 0, 0 0; }
      to{ background-position: 680px 0, 0 680px; }
    }

    .noise{
      pointer-events:none;
      position:fixed;
      inset:0;
      opacity:0.09;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.15' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.52'/%3E%3C/svg%3E");
      z-index:-3;
    }

    /* ===== FULL WIDTH WRAP ===== */
    .wrap{
      width:100%;
      max-width:none;
      margin:0;
      padding:0 32px 40px;
    }

    /* ===== NAVBAR ===== */
    header{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter:blur(18px);
      background:
        linear-gradient(to bottom, rgba(5,5,5,0.96), rgba(5,5,5,0.85), rgba(5,5,5,0.35));
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    header::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-1px;
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(179,31,36,0.55), transparent);
      opacity:0.5;
      pointer-events:none;
    }

    .nav{
      width:100%;
      max-width:none;
      margin:0;
      padding:14px 32px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:18px;
      position:relative;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:#fff;
    }
    .brand img{
      height:40px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 24px rgba(179,31,36,0.25));
      transition: transform .25s ease, filter .25s ease;
    }
    .brand:hover img{
      transform: translateY(-1px) scale(1.02);
      filter: drop-shadow(0 12px 26px rgba(179,31,36,0.35));
    }
    .brand-text{
      display:flex;
      flex-direction:column;
      gap:2px;
      line-height:1;
    }
    .brand-title{
      font-family: "Rajdhani", Arial, sans-serif;
      font-size:20px;
      font-weight:700;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .brand-sub{
      font-size:10px;
      text-transform:uppercase;
      color:var(--muted2);
      letter-spacing:.18em;
      opacity:.95;
    }

    .nav-links{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:13px;
      text-transform:uppercase;
    }
    .nav-links a{
      text-decoration:none;
      color:var(--muted);
      padding:7px 12px;
      border-radius:999px;
      border:1px solid transparent;
      background:rgba(20,20,20,0.7);
      display:flex;
      align-items:center;
      gap:8px;
      transition:all .18s ease-out;
    }
    .nav-links a span.dot{
      width:6px;height:6px;border-radius:999px;
      background:rgba(255,255,255,0.3);
    }
    .nav-links a:hover{
      color:var(--text);
      border-color:rgba(255,255,255,0.18);
      transform:translateY(-1px);
      box-shadow:0 10px 25px rgba(0,0,0,0.6);
    }
    .nav-links a.active{
      color:#fff;
      border-color:rgba(179,31,36,0.8);
      background:linear-gradient(135deg, rgba(179,31,36,0.14), rgba(179,31,36,0.02));
    }
    .nav-links a.active .dot{
      background:var(--red);
      box-shadow:0 0 12px rgba(179,31,36,0.85);
    }

    /* ===== PAGE HEADER ===== */
    .page-header{
      padding:30px 0 10px;
    }
    .page-kicker{
      font-size:11px;
      text-transform:uppercase;
      color:var(--muted2);
      letter-spacing:0.25em;
      margin-bottom:8px;
    }
    .page-title{
      font-family:"Rajdhani", Arial, sans-serif;
      font-size:36px;
      font-weight:700;
      letter-spacing:0.14em;
      text-transform:uppercase;
      margin:0 0 10px;
    }
    .page-sub{
      font-size:14px;
      color:var(--muted);
      max-width:none;
      line-height:1.55;
    }

    /* ===== Trust strip ===== */
    .trust-strip{
      margin-top:16px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .trust-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.15));
      color:rgba(255,255,255,0.88);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      box-shadow: 0 10px 24px rgba(0,0,0,0.45);
    }
    .trust-pill b{color:#fff}
    .trust-pill .i{
      width:18px;height:18px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.03);
      font-size:12px;
      opacity:.95;
    }
    .trust-pill.red{
      border-color: rgba(179,31,36,0.45);
      box-shadow: 0 12px 30px rgba(179,31,36,0.16);
    }

    /* ===== Filter bar ===== */
    .filterbar{
      margin-top:18px;
      background:
        radial-gradient(circle at 20% 0%, rgba(179,31,36,0.14), transparent 52%),
        linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.16));
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      padding: 14px 14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      box-shadow: 0 18px 55px rgba(0,0,0,0.45);
      position:relative;
      overflow:hidden;
    }
    .filterbar::before{
      content:"";
      position:absolute;
      inset:-60px;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.04), transparent 55%);
      transform: rotate(12deg);
      pointer-events:none;
      opacity:.85;
    }
    .filterbar > *{ position:relative; }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 160px;
    }
    .field label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:var(--muted2);
    }
    .field input, .field select{
      background: rgba(0,0,0,0.35);
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.12);
      padding: 10px 12px;
      font-size:14px;
      color:#fff;
      outline:none;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .field input:focus, .field select:focus{
      border-color: rgba(179,31,36,0.55);
      box-shadow: 0 0 0 3px rgba(179,31,36,0.12);
    }
    .field select option{ color:#000; }

    .field-grow{ flex:1 1 260px; min-width: 220px; }

    .toggle-row{
      display:flex;
      align-items:center;
      gap:10px;
      padding-top: 18px;
    }
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.85);
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease;
    }
    .toggle:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.18);
      box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    }
    .switch{
      width:44px; height:24px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.45);
      position:relative;
    }
    .switch::after{
      content:"";
      position:absolute;
      top:3px; left:3px;
      width:18px; height:18px;
      border-radius:999px;
      background: rgba(255,255,255,0.75);
      transition: transform .18s ease, background .18s ease;
    }
    .toggle.is-on{
      border-color: rgba(179,31,36,0.55);
      box-shadow: 0 12px 30px rgba(179,31,36,0.14);
    }
    .toggle.is-on .switch{
      border-color: rgba(179,31,36,0.55);
      background: rgba(179,31,36,0.18);
    }
    .toggle.is-on .switch::after{
      transform: translateX(20px);
      background: #fff;
    }

    .filter-actions{
      margin-left:auto;
      display:flex;
      gap:10px;
      align-items:flex-end;
      padding-top: 18px;
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 14px;
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--red), #740509);
      color:#fff;
      box-shadow: 0 16px 38px rgba(179,31,36,0.25);
    }
    .btn-primary:hover{ transform: translateY(-1px); filter: brightness(1.04); }
    .btn-ghost{
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.9);
      border: 1px solid rgba(255,255,255,0.12);
    }
    .btn-ghost:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.18);
      box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    }

    .result-meta{
      margin-top: 12px;
      color: var(--muted2);
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .result-meta b{ color:#fff; }

    /* ===== SEKCIA SKLADOM ===== */
    section.catalog-section{
      margin:18px 0 32px;
    }
    .section-header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
      margin-top: 18px;
    }
    .section-title{
      font-family:"Rajdhani", Arial, sans-serif;
      font-size:18px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.16em;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .section-title::before{
      content:"";
      width:22px;
      height:2px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--red), transparent);
    }
    .section-note{
      font-size:12px;
      color:var(--muted2);
      max-width:none;
      line-height:1.4;
    }

    /* ===== GRID ===== */
    .parts-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(280px, 320px));
      gap:16px;
      justify-content:flex-start;
      align-items:stretch;
    }

    /* ===== CARDS: premium look + shine sweep ===== */
    .part-card{
      position:relative;
      background:
        radial-gradient(circle at top left, rgba(179,31,36,0.11), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.16)),
        var(--panel);
      border-radius:var(--radius-xl);
      border:1px solid var(--line);
      padding:14px 14px 12px;
      box-shadow:var(--shadow);
      overflow:hidden;
      transform: translateZ(0);
      transition: transform .16s ease, border-color .16s ease, box-shadow .16s ease, filter .16s ease;
      cursor:pointer;
      will-change: transform;
    }

    /* hover outline */
    .part-card:hover{
      transform: translateY(-3px);
      border-color: rgba(179,31,36,0.35);
      box-shadow: 0 22px 70px rgba(0,0,0,0.65);
      filter: brightness(1.03);
    }

    /* shine sweep */
    .part-card::before{
      content:"";
      position:absolute;
      top:-40%;
      left:-60%;
      width: 140%;
      height: 140%;
      background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,0.08) 50%, transparent 65%);
      transform: rotate(10deg);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
    }
    .part-card:hover::before{
      opacity:1;
      animation: shine 1.05s ease forwards;
    }
    @keyframes shine{
      0%{ transform: translateX(-10%) rotate(10deg); }
      100%{ transform: translateX(28%) rotate(10deg); }
    }

    /* ribbon for status */
    .ribbon{
      position:absolute;
      top:14px;
      left:-52px;
      width: 170px;
      transform: rotate(-35deg);
      text-align:center;
      padding:7px 0;
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:800;
      color:#fff;
      border:1px solid rgba(255,255,255,0.20);
      backdrop-filter: blur(10px);
      opacity:0.95;
      pointer-events:none;
    }
    .ribbon.reserved{
      background: rgba(245,158,11,0.82);
      box-shadow: 0 16px 44px rgba(245,158,11,0.20);
    }
    .ribbon.sold{
      background: rgba(239,68,68,0.78);
      box-shadow: 0 16px 44px rgba(239,68,68,0.18);
    }

    .part-top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
      align-items:flex-start;
    }

    .part-name{
      font-size:15px;
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-family:"Rajdhani", Arial, sans-serif;
    }

    .part-meta{
      font-size:11px;
      color:var(--muted2);
      line-height:1.4;
      margin-top:2px;
    }

    .badge-row{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
      flex-shrink:0;
    }

    .part-badge{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      white-space:nowrap;
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.9);
    }

    .part-badge.in-stock{
      border-color:rgba(34,197,94,0.95);
      color:#d9ffe9;
      background: radial-gradient(circle at top, rgba(34,197,94,0.22), transparent 60%);
      box-shadow:0 0 18px rgba(34,197,94,0.28);
    }

    /* quick info chips (condition/city/stock) */
    .quickrow{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .qchip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.85);
      font-size:10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.92;
    }
    .qchip svg{ width:12px; height:12px; opacity:.9; }
    .qchip.ok{ border-color: rgba(34,197,94,0.55); }
    .qchip.warn{ border-color: rgba(245,158,11,0.55); }

    /* image glass */
    .part-image{
      width:100%;
      height:210px;
      border-radius:16px;
      overflow:hidden;
      margin:8px 0 10px;
      border:1px solid rgba(255,255,255,0.10);
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.05), transparent 50%),
        rgba(0,0,0,0.45);
      position:relative;
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
    }

    .part-image img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      transform: scale(1);
      transition: transform .22s ease, filter .22s ease;
      filter: contrast(1.02);
    }
    .part-card:hover .part-image img{
      transform: scale(1.03);
    }

    .image-nav-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(0,0,0,0.60);
      color:#fff;
      font-size:14px;
      cursor:pointer;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease-out, transform .18s ease-out, border-color .18s ease-out;
      backdrop-filter: blur(8px);
    }
    .image-nav-btn.prev{ left:8px; }
    .image-nav-btn.next{ right:8px; }
    .part-image:hover .image-nav-btn{
      opacity:1;
      pointer-events:auto;
      transform:translateY(-50%) scale(1.02);
    }
    .image-nav-btn:hover{
      border-color: rgba(179,31,36,0.55);
      transform: translateY(-50%) scale(1.06);
    }

    .thumbhint{
      position:absolute;
      right:10px;
      bottom:10px;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.45);
      color: rgba(255,255,255,0.85);
      font-size:10px;
      letter-spacing:.14em;
      text-transform:uppercase;
      opacity:.88;
      backdrop-filter: blur(8px);
      display:none;
    }
    .part-image.has-gallery .thumbhint{ display:inline-flex; }

    .part-tags{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
    }

    .tag{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.11em;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      color:var(--muted2);
      background:rgba(8,8,8,0.9);
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, border-color .14s ease, color .14s ease, background .14s ease;
    }
    .tag:hover{
      transform: translateY(-1px);
      border-color: rgba(179,31,36,0.35);
      color: rgba(255,255,255,0.9);
      background: rgba(179,31,36,0.08);
    }

    .part-note{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
      line-height:1.5;
      opacity:.95;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    .part-bottom{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:11px;
    }

    .price{
      font-size:13px;
      font-weight:800;
      letter-spacing:.06em;
      font-family:"Rajdhani", Arial, sans-serif;
      color:#fff;
    }
    .price .num{
      color: var(--red);
      text-shadow: 0 0 16px rgba(179,31,36,0.25);
    }
    .price span{
      font-size:11px;
      font-weight:400;
      color:var(--muted2);
      margin-left:6px;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-family: Arial, sans-serif;
    }

    .cta-mini{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(135deg, var(--red), #740509);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      cursor:pointer;
      text-decoration:none;
      color:#fff;
      white-space:nowrap;
      transition:all .16s ease-out;
      box-shadow: 0 14px 34px rgba(179,31,36,0.18);
    }
    .cta-mini:hover{
      transform:translateY(-1px);
      box-shadow:0 16px 44px rgba(179,31,36,0.32);
      filter: brightness(1.03);
    }

    /* ===== EMPTY STATE ===== */
    .empty{
      padding: 18px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      color: var(--muted2);
      font-size:13px;
      line-height:1.6;
    }

    /* ===== FOOTER ===== */
    footer{
      border-top:1px solid rgba(255,255,255,0.06);
      padding:18px 0 30px;
      font-size:11px;
      color:var(--muted2);
      background: rgba(0,0,0,0.25);
    }
    footer .row{
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:8px;
      padding:0 32px;
    }
    footer a{ color:var(--muted); text-decoration:none; }
    footer a:hover{ color:#fff; text-decoration:underline; }

    /* ===== QUICK VIEW MODAL ===== */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.82);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:120;
      padding:16px;
    }
    .modal-backdrop.active{ display:flex; }

    .modal{
      background:
        radial-gradient(circle at 20% 0%, rgba(179,31,36,0.14), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25)),
        #0d0d0d;
      border-radius:24px;
      border:1px solid rgba(255,255,255,0.14);
      box-shadow:0 30px 100px rgba(0,0,0,0.90);
      width:100%;
      max-width:980px;
      overflow:hidden;
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      position:relative;
    }

    .modal-close{
      position:absolute;
      right:14px;
      top:10px;
      border:none;
      background:transparent;
      color:rgba(255,255,255,0.75);
      font-size:24px;
      cursor:pointer;
      padding:8px;
      z-index:5;
      transition: transform .15s ease, color .15s ease;
    }
    .modal-close:hover{ transform: scale(1.06); color:#fff; }

    .modal-media{
      padding:14px;
      background: rgba(0,0,0,0.55);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .media-main{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.12);
      background: #060606;
      box-shadow: 0 22px 75px rgba(0,0,0,0.75);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 420px;
    }
    .media-main img{
      width:100%;
      height:100%;
      max-height: 60vh;
      object-fit:contain;
      display:block;
      cursor: zoom-in;
    }

    .modal-arrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:40px;
      height:40px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(0,0,0,0.55);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:20px;
      color:#fff;
      backdrop-filter:blur(8px);
      transition: transform .15s ease, border-color .15s ease, background .15s ease, opacity .15s ease;
      opacity:.88;
    }
    .modal-arrow:hover{
      background:rgba(0,0,0,0.92);
      border-color:rgba(179,31,36,0.7);
      transform:translateY(-50%) scale(1.06);
      opacity:1;
    }
    .modal-prev{ left:12px; }
    .modal-next{ right:12px; }

    .media-thumbs{
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding: 4px 2px 6px;
      -webkit-overflow-scrolling: touch;
    }
    .media-thumbs::-webkit-scrollbar{ height: 10px; }
    .media-thumbs::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,0.14);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0.35);
    }
    .thumb{
      flex:0 0 84px;
      height:64px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.12);
      background:#050505;
      cursor:pointer;
      opacity:.75;
      transition: opacity .12s ease, transform .12s ease, border-color .12s ease;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    .thumb:hover{
      opacity:1;
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.18);
    }
    .thumb.active{
      opacity:1;
      border-color: rgba(179,31,36,0.65);
      box-shadow: 0 0 0 2px rgba(179,31,36,0.12);
    }

    .modal-counter{
      position:absolute;
      right:14px;
      bottom:14px;
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:rgba(255,255,255,0.8);
      background:rgba(0,0,0,0.55);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.20);
      backdrop-filter:blur(8px);
    }

    .modal-info{
      padding:22px 22px 18px;
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.65));
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .modal-title{
      font-family:"Rajdhani", Arial, sans-serif;
      font-size:18px;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.16em;
      margin:0;
    }

    .modal-meta-line{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }

    .mchip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.88);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .mchip svg{ width:14px; height:14px; opacity:.9; }
    .mchip.ok{ border-color: rgba(34,197,94,0.55); }
    .mchip.warn{ border-color: rgba(245,158,11,0.55); }

    .modal-note{
      font-size:14px;
      line-height:1.65;
      color: var(--muted);
      margin:4px 0 0;
    }

    .modal-price{
      margin-top:8px;
      font-family:"Rajdhani", Arial, sans-serif;
      font-size:28px;
      font-weight:900;
      letter-spacing:.08em;
      color: var(--red);
      text-shadow: 0 0 18px rgba(179,31,36,0.25);
    }
    .modal-price-suffix{
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: var(--muted2);
      margin-top:2px;
    }

    .modal-tags{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }

    .modal-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    /* ===== ZOOM LIGHTBOX ===== */
    .zoom-backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.92);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:200;
      padding:18px;
    }
    .zoom-backdrop.active{ display:flex; }
    .zoom-box{
      width:100%;
      max-width:1200px;
      max-height: 86vh;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.14);
      background:#050505;
      overflow:hidden;
      box-shadow: 0 30px 110px rgba(0,0,0,0.92);
      position:relative;
    }
    .zoom-box img{
      width:100%;
      height:100%;
      max-height: 86vh;
      object-fit:contain;
      display:block;
    }
    .zoom-close{
      position:absolute;
      right:12px;
      top:10px;
      border:none;
      background: rgba(0,0,0,0.45);
      color: rgba(255,255,255,0.85);
      border:1px solid rgba(255,255,255,0.18);
      border-radius:999px;
      padding:8px 10px;
      cursor:pointer;
      backdrop-filter: blur(8px);
    }
    .zoom-close:hover{ color:#fff; border-color: rgba(179,31,36,0.45); }

    /* ===== RESPONSIVE ===== */
    @media (max-width:980px){
      .wrap{ padding:0 16px 32px; }
      .nav{ padding:12px 16px 10px; }
      footer .row{ padding:0 16px; }

      .filterbar{ padding: 12px; }
      .filter-actions{ margin-left:0; width:100%; justify-content:flex-start; padding-top:0; }

      .modal{
        grid-template-columns: 1fr;
        max-width: 720px;
      }
      .media-main{ min-height: 320px; }
      .page-title{ font-size:30px; }
    }

    @media (max-width:640px){
      .field{ min-width: 140px; }
      .page-title{ font-size:26px; }
      .parts-grid{
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="bg-ambient"></div>
  <div class="gridlayer"></div>
  <div class="noise"></div>

  <header>
    <nav class="nav">
      <a class="brand" href="index.html" aria-label="RACEM homepage">
        <img src="assets/racem-logo.png" alt="RACEM logo">
        <div class="brand-text">
          <div class="brand-title">RACEM</div>
          <div class="brand-sub">BEAT THEM ALL</div>
        </div>
      </a>

      <div class="nav-links">
        <a href="index.html">
          <span class="dot"></span><span>Homepage</span>
        </a>
        <a href="katalog.html" class="active">
          <span class="dot"></span><span>Katal√≥g dielov</span>
        </a>
        <a href="vop.html">
          <span class="dot"></span><span>VOP & reklam√°cie</span>
        </a>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <section class="page-header">
      <div class="page-kicker">REM PERFORMANCE ¬∑ RACEM</div>
      <h1 class="page-title">KATAL√ìG DIELOV</h1>
      <p class="page-sub">
        Toto s√∫ diely, ktor√© m√°me fyzicky <b>na sklade doma</b> a vieme ich posla≈• hneƒè.
        Potrebuje≈° nieƒço in√©? Nap√≠≈° na <b>info@remperformance.sk</b> a n√°≈° t√≠m to prever√≠.
      </p>

      <div class="trust-strip">
        <span class="trust-pill red"><span class="i">‚úì</span> <b>Skladom u n√°s doma</b></span>
        <span class="trust-pill"><span class="i">üöö</span> Odosielanie 1‚Äì2√ó t√Ω≈ædenne</span>
        <span class="trust-pill"><span class="i">üí¨</span> R√Ωchly dopyt cez formul√°r</span>
      </div>

      <!-- FILTER BAR -->
      <div class="filterbar" id="filterbar">
        <div class="field field-grow">
          <label>Hƒæada≈•</label>
          <input id="qSearch" type="text" placeholder="napr. okno e46, brzdy, svetl√°...">
        </div>

        <div class="field">
          <label>Stav</label>
          <select id="qCondition">
            <option value="">V≈°etko</option>
            <option value="new">Nov√©</option>
            <option value="used">Pou≈æit√©</option>
          </select>
        </div>

        <div class="field">
          <label>Mesto</label>
          <select id="qCity">
            <option value="">V≈°etko</option>
          </select>
        </div>

        <div class="field">
          <label>Sort</label>
          <select id="qSort">
            <option value="default">Odpor√∫ƒçan√©</option>
            <option value="price-asc">Cena ‚Üë</option>
            <option value="price-desc">Cena ‚Üì</option>
            <option value="name-asc">N√°zov A‚ÄìZ</option>
            <option value="name-desc">N√°zov Z‚ÄìA</option>
          </select>
        </div>

        <div class="toggle-row">
          <div id="qOnlyAvailable" class="toggle" role="button" tabindex="0" aria-pressed="false">
            <div class="switch" aria-hidden="true"></div>
            Len dostupn√©
          </div>
        </div>

        <div class="filter-actions">
          <button class="btn btn-ghost" id="btnClear" type="button">Clear</button>
          <button class="btn btn-primary" id="btnContact" type="button">R√Ωchly dopyt</button>
        </div>
      </div>

      <div class="result-meta" id="resultMeta" style="display:none;"></div>
    </section>

    <section id="skladom" class="catalog-section">
      <div class="section-header">
        <h2 class="section-title">Skladom ‚Äì k odoslaniu ihneƒè</h2>
        <p class="section-note">
          Diely, ktor√© s√∫ fyzicky u n√°s. Po potvrden√≠ dopytu ich vieme zabali≈• a posla≈• v najbli≈æ≈°om odosielacom term√≠ne.
          Poƒçet kusov je obmedzen√Ω.
        </p>
      </div>

      <div id="parts-skladom" class="parts-grid"></div>
    </section>
  </main>

  <footer>
    <div class="row">
      <div>RACEM / REM Performance ¬∑ Luk√°≈° Tonkoviƒç ¬∑ IƒåO 57321205</div>
      <div>
        <a href="mailto:info@remperformance.sk">info@remperformance.sk</a> ¬∑
        <a href="vop.html">VOP a reklamaƒçn√Ω poriadok</a>
      </div>
    </div>
  </footer>

  <!-- QUICK VIEW MODAL -->
  <div id="quick-modal-backdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="qmTitle" onclick="event.stopPropagation()">
      <button class="modal-close" type="button" id="qmClose" aria-label="Zavrie≈•">‚úï</button>

      <div class="modal-media">
        <div class="media-main">
          <button class="modal-arrow modal-prev" type="button" id="qmPrev" aria-label="Predch√°dzaj√∫ci obr√°zok">‚Äπ</button>
          <img id="qmImg" src="" alt="">
          <button class="modal-arrow modal-next" type="button" id="qmNext" aria-label="Nasleduj√∫ci obr√°zok">‚Ä∫</button>
          <div class="modal-counter" id="qmCounter">1 / 1</div>
        </div>
        <div class="media-thumbs" id="qmThumbs"></div>
      </div>

      <div class="modal-info">
        <h3 class="modal-title" id="qmTitle"></h3>

        <div class="modal-meta-line" id="qmMetaLine"></div>

        <div class="modal-tags" id="qmTags"></div>

        <p class="modal-note" id="qmNote"></p>

        <div class="modal-price" id="qmPrice"></div>
        <div class="modal-price-suffix" id="qmSuffix"></div>

        <div class="modal-actions">
          <button class="btn btn-primary" type="button" id="qmInterest">M√°m z√°ujem</button>
          <button class="btn btn-ghost" type="button" id="qmClose2">Zavrie≈•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ZOOM -->
  <div id="zoomBackdrop" class="zoom-backdrop" aria-hidden="true">
    <div class="zoom-box" onclick="event.stopPropagation()">
      <button class="zoom-close" type="button" id="zoomClose">Zavrie≈•</button>
      <img id="zoomImg" src="" alt="">
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const JSON_URL = "skladom.json";
    const CONTACT_JUMP = "index.html#kontakt"; // r√Ωchly dopyt -> kontakt na home (m√°≈° to tam hotov√©)

    // ========= ICONS (inline svg) =========
    const ICONS = {
      check: `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M9 16.2 4.8 12 3.4 13.4 9 19 21 7 19.6 5.6z"/></svg>`,
      tool: `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M22.7 19.3 14 10.6c.7-2.2.1-4.7-1.7-6.5C10.2 2 7.2 1.6 4.7 2.8l4.1 4.1-2.8 2.8-4.1-4.1C.7 8 .9 11 3.1 13.1c1.8 1.8 4.3 2.4 6.5 1.7l8.7 8.7c.4.4 1 .4 1.4 0l3-3c.4-.4.4-1 0-1.4z"/></svg>`,
      pin: `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/></svg>`,
      box: `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M21 8l-9-5-9 5 9 5 9-5zm-9 7L3 10v10l9 5 9-5V10l-9 5z"/></svg>`
    };

    // ========= HELPERS =========
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function safeText(v){ return (v == null) ? "" : String(v); }

    function parseEuroPrice(str){
      // "85 ‚Ç¨" / "85‚Ç¨" / "85 EUR" / "Na dopyt" -> number or null
      const s = safeText(str).replace(",", ".").toLowerCase();
      const m = s.match(/(\d+(\.\d+)?)/);
      return m ? Number(m[1]) : null;
    }

    function normalizePart(raw){
      const part = Object.assign({}, raw);

      const base = (part.image && String(part.image).trim())
        ? String(part.image).trim()
        : "img/placeholder-part.jpg";

      const extra = Array.isArray(part.images)
        ? part.images.map(String).map(s => s.trim()).filter(s => s.length)
        : [];

      const allImages = [base, ...extra.filter(src => src !== base)];

      // status (optional): "reserved" | "sold" | ""  (you can add this in JSON)
      const status = safeText(part.status).trim().toLowerCase();

      // condition normalization
      const cond = safeText(part.condition).trim().toLowerCase();
      const isNew = cond.startsWith("nov") || cond === "new";
      const conditionKey = isNew ? "new" : (cond ? "used" : "");

      // stock number extraction (optional)
      const stockLabel = safeText(part.stockLabel);
      const stockNumMatch = stockLabel.match(/(\d+)/);
      const stockNum = stockNumMatch ? parseInt(stockNumMatch[1], 10) : null;

      part.baseImage = base;
      part.allImages = allImages;
      part.status = status; // reserved/sold/...
      part.conditionKey = conditionKey; // new/used/""
      part.stockNum = stockNum; // number or null
      part.priceNum = parseEuroPrice(part.price);

      return part;
    }

    function buildCardHTML(part){
      const tags = Array.isArray(part.tags) ? part.tags : [];
      const tagsHtml = tags.map(t => `<span class="tag" data-tag="${encodeURIComponent(t)}">${t}</span>`).join("");

      const imageSrc = (part.allImages && part.allImages.length)
        ? part.allImages[0]
        : part.baseImage || "img/placeholder-part.jpg";

      const hasGallery = part.allImages && part.allImages.length > 1;

      // ribbon
      let ribbonHtml = "";
      if (part.status === "reserved") ribbonHtml = `<div class="ribbon reserved">Rezervovan√©</div>`;
      if (part.status === "sold") ribbonHtml = `<div class="ribbon sold">Predan√©</div>`;

      // badges / quick chips
      const conditionLabel = part.conditionKey === "new" ? "Nov√©" : (part.conditionKey === "used" ? "Pou≈æit√©" : "");
      const conditionChip = conditionLabel
        ? `<span class="qchip ${part.conditionKey === "new" ? "ok" : "warn"}">${ICONS.tool} ${conditionLabel}</span>`
        : "";

      const cityChip = part.city
        ? `<span class="qchip">${ICONS.pin} ${safeText(part.city)}</span>`
        : "";

      const stockChip = part.stockLabel
        ? `<span class="qchip ok">${ICONS.box} ${safeText(part.stockLabel)}</span>`
        : "";

      // price styling (number red, suffix gray)
      const priceValue = safeText(part.price) || "Na dopyt";
      const suffix = safeText(part.price_suffix);

      const priceNum = parseEuroPrice(priceValue);
      const styledPrice = (priceNum != null)
        ? `<span class="num">${priceValue}</span>`
        : `${priceValue}`;

      return `
        <article class="part-card"
                 data-id="${safeText(part.id)}"
                 data-name="${encodeURIComponent(safeText(part.name))}"
                 data-city="${encodeURIComponent(safeText(part.city))}"
                 data-condition="${safeText(part.conditionKey)}"
                 data-status="${safeText(part.status)}"
                 data-price="${safeText(part.price)}"
                 data-price-num="${part.priceNum != null ? part.priceNum : ""}"
                 data-suffix="${encodeURIComponent(suffix)}"
                 data-note="${encodeURIComponent(safeText(part.note))}"
                 data-meta="${encodeURIComponent(safeText(part.meta))}"
                 data-tags="${encodeURIComponent((Array.isArray(part.tags)?part.tags:[]).join("|"))}"
                 data-images="${encodeURIComponent((part.allImages||[]).join("|"))}"
                 data-stocknum="${part.stockNum != null ? part.stockNum : ""}"
        >
          ${ribbonHtml}

          <div class="part-top">
            <div>
              <div class="part-name">${safeText(part.name)}</div>
              <div class="part-meta">${safeText(part.meta)}</div>
            </div>

            <div class="badge-row">
              <div class="part-badge in-stock">${safeText(part.stockLabel) || "Skladom"}</div>
              <div class="quickrow">
                ${conditionChip}
                ${cityChip}
                ${stockChip}
              </div>
            </div>
          </div>

          <div class="part-image ${hasGallery ? "has-gallery" : ""}" data-current-index="0">
            <img src="${imageSrc}" alt="${safeText(part.name) || "diel"}" loading="lazy">
            ${hasGallery ? `
              <button type="button" class="image-nav-btn prev" aria-label="Predch√°dzaj√∫ca fotka">&#10094;</button>
              <button type="button" class="image-nav-btn next" aria-label="ƒéal≈°ia fotka">&#10095;</button>
              <span class="thumbhint">gal√©ria</span>
            ` : ""}
          </div>

          ${tagsHtml ? `<div class="part-tags">${tagsHtml}</div>` : ""}

          <p class="part-note">${safeText(part.note)}</p>

          <div class="part-bottom">
            <div class="price">
              Cena: ${styledPrice}
              ${suffix ? `<span>${suffix}</span>` : ""}
            </div>

            <button type="button" class="cta-mini cta-open">
              Quick view
            </button>
          </div>
        </article>
      `;
    }

    // ========= STATE =========
    let ALL = [];
    let VIEW = [];

    const ui = {
      container: $("#parts-skladom"),
      resultMeta: $("#resultMeta"),
      qSearch: $("#qSearch"),
      qCondition: $("#qCondition"),
      qCity: $("#qCity"),
      qSort: $("#qSort"),
      qOnlyAvailable: $("#qOnlyAvailable"),
      btnClear: $("#btnClear"),
      btnContact: $("#btnContact"),
    };

    const toggles = {
      onlyAvailable: false
    };

    function setResultMeta(text){
      if (!text){
        ui.resultMeta.style.display = "none";
        ui.resultMeta.textContent = "";
        return;
      }
      ui.resultMeta.style.display = "flex";
      ui.resultMeta.innerHTML = text;
    }

    function buildCityOptions(items){
      const cities = Array.from(new Set(items.map(x => safeText(x.city).trim()).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
      ui.qCity.innerHTML = `<option value="">V≈°etko</option>` + cities.map(c => `<option value="${encodeURIComponent(c)}">${c}</option>`).join("");
    }

    function applyFilters(){
      const q = safeText(ui.qSearch.value).trim().toLowerCase();
      const cond = safeText(ui.qCondition.value);
      const city = decodeURIComponent(safeText(ui.qCity.value || ""));

      let out = ALL.slice();

      if (q){
        out = out.filter(p => {
          const hay = [
            safeText(p.name),
            safeText(p.meta),
            safeText(p.note),
            safeText(p.city),
            Array.isArray(p.tags) ? p.tags.join(" ") : ""
          ].join(" ").toLowerCase();
          return hay.includes(q);
        });
      }

      if (cond){
        out = out.filter(p => p.conditionKey === cond);
      }

      if (city){
        out = out.filter(p => safeText(p.city).trim() === city);
      }

      if (toggles.onlyAvailable){
        // if stockNum exists -> >0
        // otherwise: allow if not sold
        out = out.filter(p => {
          if (p.status === "sold") return false;
          if (p.stockNum != null) return p.stockNum > 0;
          // fallback: if stockLabel exists -> true
          return !!safeText(p.stockLabel).trim();
        });
      }

      // sorting
      const sort = safeText(ui.qSort.value);
      if (sort === "price-asc"){
        out.sort((a,b) => {
          const pa = (a.priceNum == null) ? Number.POSITIVE_INFINITY : a.priceNum;
          const pb = (b.priceNum == null) ? Number.POSITIVE_INFINITY : b.priceNum;
          return pa - pb;
        });
      } else if (sort === "price-desc"){
        out.sort((a,b) => {
          const pa = (a.priceNum == null) ? -1 : a.priceNum;
          const pb = (b.priceNum == null) ? -1 : b.priceNum;
          return pb - pa;
        });
      } else if (sort === "name-asc"){
        out.sort((a,b)=> safeText(a.name).localeCompare(safeText(b.name)));
      } else if (sort === "name-desc"){
        out.sort((a,b)=> safeText(b.name).localeCompare(safeText(a.name)));
      } else {
        // default: keep json order
      }

      VIEW = out;

      // render
      if (!VIEW.length){
        ui.container.innerHTML = `
          <div class="empty">
            Niƒç sa nena≈°lo pre aktu√°lne filtre. Sk√∫s zmaza≈• filtre alebo nap√≠≈° na <b>info@remperformance.sk</b>.
          </div>
        `;
        setResultMeta(`<span>Zobrazen√©: <b>0</b> / ${ALL.length}</span>`);
        return;
      }

      ui.container.innerHTML = VIEW.map(buildCardHTML).join("");

      setResultMeta(`<span>Zobrazen√©: <b>${VIEW.length}</b> / ${ALL.length}</span>`);
    }

    function setToggle(el, on){
      el.classList.toggle("is-on", !!on);
      el.setAttribute("aria-pressed", on ? "true" : "false");
    }

    // ========= QUICK VIEW MODAL =========
    const qm = {
      backdrop: $("#quick-modal-backdrop"),
      close: $("#qmClose"),
      close2: $("#qmClose2"),
      img: $("#qmImg"),
      prev: $("#qmPrev"),
      next: $("#qmNext"),
      counter: $("#qmCounter"),
      thumbs: $("#qmThumbs"),
      title: $("#qmTitle"),
      note: $("#qmNote"),
      price: $("#qmPrice"),
      suffix: $("#qmSuffix"),
      tags: $("#qmTags"),
      metaLine: $("#qmMetaLine"),
      interest: $("#qmInterest"),
    };

    const zoom = {
      backdrop: $("#zoomBackdrop"),
      img: $("#zoomImg"),
      close: $("#zoomClose"),
    };

    const modalState = {
      part: null,
      images: [],
      index: 0,
    };

    function decodePipe(str){
      const s = decodeURIComponent(str || "");
      return s ? s.split("|").map(x => x.trim()).filter(Boolean) : [];
    }

    function openModalFromCard(cardEl){
      const name = decodeURIComponent(cardEl.dataset.name || "");
      const meta = decodeURIComponent(cardEl.dataset.meta || "");
      const note = decodeURIComponent(cardEl.dataset.note || "");
      const tags = decodePipe(cardEl.dataset.tags || "");
      const images = decodePipe(cardEl.dataset.images || "");
      const price = safeText(cardEl.dataset.price) || "Na dopyt";
      const suffix = decodeURIComponent(cardEl.dataset.suffix || "");
      const city = decodeURIComponent(cardEl.dataset.city || "");
      const condition = safeText(cardEl.dataset.condition || "");
      const stockLabel = $(".part-badge.in-stock", cardEl)?.textContent?.trim() || "";

      modalState.part = {
        id: safeText(cardEl.dataset.id),
        name,
        meta,
        note,
        tags,
        images,
        price,
        suffix,
        city,
        condition,
        stockLabel
      };
      modalState.images = images.length ? images : ["img/placeholder-part.jpg"];
      modalState.index = 0;

      qm.title.textContent = name || "Diel";
      qm.note.textContent = note || meta || "";
      qm.price.textContent = price || "Na dopyt";
      qm.suffix.textContent = suffix || "";

      // meta chips
      let condLabel = "";
      if (condition === "new") condLabel = "Nov√©";
      if (condition === "used") condLabel = "Pou≈æit√©";

      qm.metaLine.innerHTML = `
        ${condLabel ? `<span class="mchip ${condition==="new"?"ok":"warn"}">${ICONS.tool} ${condLabel}</span>` : ""}
        ${city ? `<span class="mchip">${ICONS.pin} ${city}</span>` : ""}
        ${stockLabel ? `<span class="mchip ok">${ICONS.box} ${stockLabel}</span>` : ""}
      `;

      // tags clickable
      qm.tags.innerHTML = tags.map(t => `<span class="tag" data-tag="${encodeURIComponent(t)}">${t}</span>`).join("");

      // thumbs
      qm.thumbs.innerHTML = modalState.images.map((src, i) => `
        <div class="thumb ${i===0?'active':''}" data-idx="${i}">
          <img src="${src}" alt="">
        </div>
      `).join("");

      updateModalImage();
      qm.backdrop.classList.add("active");
      document.body.style.overflow = "hidden";
      qm.img.focus?.();
    }

    function updateModalImage(){
      if (!modalState.images.length) return;
      const src = modalState.images[modalState.index];
      qm.img.src = src;

      // counter
      qm.counter.textContent = `${modalState.index + 1} / ${modalState.images.length}`;

      // thumbs active
      $$(".thumb", qm.thumbs).forEach(t => t.classList.remove("active"));
      const active = $(`.thumb[data-idx="${modalState.index}"]`, qm.thumbs);
      if (active) active.classList.add("active");
    }

    function closeModal(){
      qm.backdrop.classList.remove("active");
      document.body.style.overflow = "";
      modalState.part = null;
      modalState.images = [];
      modalState.index = 0;
    }

    function openZoom(){
      if (!modalState.images.length) return;
      zoom.img.src = modalState.images[modalState.index];
      zoom.backdrop.classList.add("active");
    }
    function closeZoom(){
      zoom.backdrop.classList.remove("active");
      zoom.img.src = "";
    }

    // ========= EVENTS =========
    function bindUI(){
      // filters
      ui.qSearch.addEventListener("input", () => applyFilters());
      ui.qCondition.addEventListener("change", () => applyFilters());
      ui.qCity.addEventListener("change", () => applyFilters());
      ui.qSort.addEventListener("change", () => applyFilters());

      ui.qOnlyAvailable.addEventListener("click", () => {
        toggles.onlyAvailable = !toggles.onlyAvailable;
        setToggle(ui.qOnlyAvailable, toggles.onlyAvailable);
        applyFilters();
      });
      ui.qOnlyAvailable.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " "){
          e.preventDefault();
          toggles.onlyAvailable = !toggles.onlyAvailable;
          setToggle(ui.qOnlyAvailable, toggles.onlyAvailable);
          applyFilters();
        }
      });

      ui.btnClear.addEventListener("click", () => {
        ui.qSearch.value = "";
        ui.qCondition.value = "";
        ui.qCity.value = "";
        ui.qSort.value = "default";
        toggles.onlyAvailable = false;
        setToggle(ui.qOnlyAvailable, false);
        applyFilters();
      });

      ui.btnContact.addEventListener("click", () => {
        window.location.href = CONTACT_JUMP;
      });

      // click delegation on grid
      ui.container.addEventListener("click", (e) => {
        const card = e.target.closest(".part-card");
        if (!card) return;

        // tag click -> filter by tag
        const tag = e.target.closest(".tag");
        if (tag){
          const t = decodeURIComponent(tag.dataset.tag || "");
          ui.qSearch.value = t;
          applyFilters();
          return;
        }

        // gallery arrows inside card
        const prev = e.target.closest(".image-nav-btn.prev");
        const next = e.target.closest(".image-nav-btn.next");
        if (prev || next){
          e.stopPropagation();
          const images = decodePipe(card.dataset.images || "");
          if (images.length <= 1) return;

          const wrap = $(".part-image", card);
          const img = $("img", wrap);
          let idx = parseInt(wrap.dataset.currentIndex || "0", 10) || 0;

          idx = prev ? (idx - 1 + images.length) % images.length : (idx + 1) % images.length;
          wrap.dataset.currentIndex = String(idx);
          img.src = images[idx];
          return;
        }

        // open modal (click on button OR whole card)
        openModalFromCard(card);
      });

      // modal interactions
      qm.close.addEventListener("click", closeModal);
      qm.close2.addEventListener("click", closeModal);
      qm.backdrop.addEventListener("click", (e) => { if (e.target === qm.backdrop) closeModal(); });

      qm.prev.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!modalState.images.length) return;
        modalState.index = (modalState.index - 1 + modalState.images.length) % modalState.images.length;
        updateModalImage();
      });

      qm.next.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!modalState.images.length) return;
        modalState.index = (modalState.index + 1) % modalState.images.length;
        updateModalImage();
      });

      qm.thumbs.addEventListener("click", (e) => {
        const t = e.target.closest(".thumb");
        if (!t) return;
        const idx = parseInt(t.dataset.idx || "0", 10) || 0;
        modalState.index = idx;
        updateModalImage();
      });

      // modal tags click -> filter and close
      qm.tags.addEventListener("click", (e) => {
        const tag = e.target.closest(".tag");
        if (!tag) return;
        const t = decodeURIComponent(tag.dataset.tag || "");
        closeModal();
        ui.qSearch.value = t;
        applyFilters();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // zoom on image click
      qm.img.addEventListener("click", () => openZoom());

      // interest button -> contact page with prefilled intent (as query param you can use later if you want)
      qm.interest.addEventListener("click", () => {
        if (!modalState.part) return;
        const p = modalState.part;
        const msg = encodeURIComponent(`M√°m z√°ujem o diel: ${p.name}${p.id ? ` (ID: ${p.id})` : ""} ‚Äî ${p.price}${p.city ? `, ${p.city}` : ""}`);
        // redirect to home contact, you can read msg from hash/query later if you decide
        window.location.href = CONTACT_JUMP + (CONTACT_JUMP.includes("?") ? "&" : "?") + "msg=" + msg;
      });

      // zoom
      zoom.close.addEventListener("click", closeZoom);
      zoom.backdrop.addEventListener("click", (e) => { if (e.target === zoom.backdrop) closeZoom(); });
      document.addEventListener("keydown", (e) => {
        if (zoom.backdrop.classList.contains("active")){
          if (e.key === "Escape") closeZoom();
          return;
        }

        if (!qm.backdrop.classList.contains("active")) return;

        if (e.key === "Escape") closeModal();
        if (e.key === "ArrowRight"){
          modalState.index = (modalState.index + 1) % modalState.images.length;
          updateModalImage();
        }
        if (e.key === "ArrowLeft"){
          modalState.index = (modalState.index - 1 + modalState.images.length) % modalState.images.length;
          updateModalImage();
        }
      });
    }

    // ========= LOAD =========
    async function load(){
      try{
        const res = await fetch(JSON_URL);
        if (!res.ok) throw new Error("Nepodarilo sa naƒç√≠ta≈• skladom.json");
        const data = await res.json();

        const raw = Array.isArray(data) ? data : (data.inStock || []);
        ALL = raw.map(normalizePart);

        if (!ALL.length){
          ui.container.innerHTML = `
            <div class="empty">
              Moment√°lne nem√°me ≈æiadne diely oznaƒçen√© ako <b>skladom</b>.
              Sleduj n√°s alebo nap√≠≈° na <b>info@remperformance.sk</b>.
            </div>
          `;
          setResultMeta(`<span>Zobrazen√©: <b>0</b> / 0</span>`);
          return;
        }

        buildCityOptions(ALL);
        setToggle(ui.qOnlyAvailable, false);
        bindUI();
        applyFilters();
      }catch(err){
        console.error(err);
        ui.container.innerHTML = `
          <div class="empty">
            Nepodarilo sa naƒç√≠ta≈• skladov√© diely. Sk√∫s str√°nku obnovi≈• alebo n√°s kontaktuj e-mailom:
            <b>info@remperformance.sk</b>.
          </div>
        `;
      }
    }

    document.addEventListener("DOMContentLoaded", load);
  </script>
</body>
</html>
